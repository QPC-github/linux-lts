From 9245043ee6cd6b9601b1506a4c1b2c998fb40ac4 Mon Sep 17 00:00:00 2001
From: Miguel Bernal Marin <miguel.bernal.marin@linux.intel.com>
Date: Thu, 23 Feb 2017 13:50:15 -0600
Subject: [PATCH 2002/2002] virtualbox: setup Kconfig and Makefiles

---
 drivers/misc/Kconfig            | 31 +++++++++++++++++++++++++++++++
 drivers/misc/Makefile           |  3 +++
 drivers/misc/vboxguest/Makefile |  1 +
 drivers/misc/vboxsf/Makefile    |  1 +
 drivers/misc/vboxvideo/Makefile |  1 +
 5 files changed, 37 insertions(+)

diff --git a/drivers/misc/Kconfig b/drivers/misc/Kconfig
index 64971baf11fa..90e1aff41bac 100644
--- a/drivers/misc/Kconfig
+++ b/drivers/misc/Kconfig
@@ -766,6 +766,37 @@ config PANEL_BOOT_MESSAGE
 	  An empty message will only clear the display at driver init time. Any other
 	  printf()-formatted message is valid with newline and escape codes.
 
+config VBOXGUEST
+	tristate "VirtualBox Guest Addition driver"
+	depends on X86
+	default m
+	help
+	  This is the main driver from VirtualBox Guest Additions.
+
+	  To compile this driver as a module, choose M here: the
+	  module will be called vboxguest.
+
+config VBOXSF
+	tristate "VirtualBox Share Folder driver"
+	depends on X86 && VBOXGUEST
+	default m
+	help
+	  This is the driver to share folders between guest and
+	  host.
+
+	  To compile this driver as a module, choose M here: the
+	  module will be called vboxsf.
+
+config VBOXVIDEO
+	tristate "VirtualBox Video driver"
+	depends on X86 && VBOXGUEST
+	default m
+	help
+	  This is the video driver for VirtualBox VM.
+
+	  To compile this driver as a module, choose M here: the
+	  module will be called vboxvideo.
+
 source "drivers/misc/c2port/Kconfig"
 source "drivers/misc/eeprom/Kconfig"
 source "drivers/misc/cb710/Kconfig"
diff --git a/drivers/misc/Makefile b/drivers/misc/Makefile
index 31983366090a..3a208b3ce375 100644
--- a/drivers/misc/Makefile
+++ b/drivers/misc/Makefile
@@ -53,6 +53,9 @@ obj-$(CONFIG_ECHO)		+= echo/
 obj-$(CONFIG_VEXPRESS_SYSCFG)	+= vexpress-syscfg.o
 obj-$(CONFIG_CXL_BASE)		+= cxl/
 obj-$(CONFIG_PANEL)             += panel.o
+obj-$(CONFIG_VBOXGUEST)		+= vboxguest/
+obj-$(CONFIG_VBOXSF)		+= vboxsf/
+obj-$(CONFIG_VBOXVIDEO)		+= vboxvideo/
 
 lkdtm-$(CONFIG_LKDTM)		+= lkdtm_core.o
 lkdtm-$(CONFIG_LKDTM)		+= lkdtm_bugs.o
diff --git a/drivers/misc/vboxguest/Makefile b/drivers/misc/vboxguest/Makefile
index b40364795729..5235d0de9777 100644
--- a/drivers/misc/vboxguest/Makefile
+++ b/drivers/misc/vboxguest/Makefile
@@ -18,6 +18,7 @@
 # Linux kbuild sets this to our source directory if we are called from there
 obj ?= $(CURDIR)
 include $(obj)/Makefile.include.header
+KBUILD_EXTMOD=$(obj)
 
 MOD_NAME = vboxguest
 
diff --git a/drivers/misc/vboxsf/Makefile b/drivers/misc/vboxsf/Makefile
index 97f2080afc62..e30e8b9274f4 100644
--- a/drivers/misc/vboxsf/Makefile
+++ b/drivers/misc/vboxsf/Makefile
@@ -17,6 +17,7 @@
 # Linux kbuild sets this to our source directory if we are called from there
 obj ?= $(CURDIR)
 include $(obj)/Makefile.include.header
+KBUILD_EXTMOD=$(obj)
 
 MOD_NAME = vboxsf
 MOD_OBJS   = \
diff --git a/drivers/misc/vboxvideo/Makefile b/drivers/misc/vboxvideo/Makefile
index 2869925b948b..cefc59f1572a 100644
--- a/drivers/misc/vboxvideo/Makefile
+++ b/drivers/misc/vboxvideo/Makefile
@@ -20,6 +20,7 @@
 # Linux kbuild sets this to our source directory if we are called from there
 obj ?= $(CURDIR)
 include $(obj)/Makefile.include.header
+KBUILD_EXTMOD=$(obj)
 
 MOD_NAME   = vboxvideo
 
-- 
2.11.1

