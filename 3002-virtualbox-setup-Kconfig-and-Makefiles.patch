From 8ad7cdb57a2a9a54fd6be735507e1e9b7c9662c3 Mon Sep 17 00:00:00 2001
From: Miguel Bernal Marin <miguel.bernal.marin@linux.intel.com>
Date: Tue, 16 Aug 2016 22:54:15 -0500
Subject: [PATCH 3002/3002] virtualbox: setup Kconfig and Makefiles

---
 drivers/misc/Kconfig            | 31 +++++++++++++++++++++++++++++++
 drivers/misc/Makefile           |  3 +++
 drivers/misc/vboxguest/Makefile |  1 +
 drivers/misc/vboxsf/Makefile    |  1 +
 drivers/misc/vboxvideo/Makefile |  1 +
 5 files changed, 37 insertions(+)

diff --git a/drivers/misc/Kconfig b/drivers/misc/Kconfig
index 4bf7d50..2df7393 100644
--- a/drivers/misc/Kconfig
+++ b/drivers/misc/Kconfig
@@ -525,6 +525,37 @@ config VEXPRESS_SYSCFG
 	  bus. System Configuration interface is one of the possible means
 	  of generating transactions on this bus.
 
+config VBOXGUEST
+	tristate "VirtualBox Guest Addition driver"
+	depends on X86
+	default m
+	help
+	  This is the main driver from VirtualBox Guest Additions.
+
+	  To compile this driver as a module, choose M here: the
+	  module will be called vboxguest.
+
+config VBOXSF
+	tristate "VirtualBox Share Folder driver"
+	depends on X86 && VBOXGUEST
+	default m
+	help
+	  This is the driver to share folders between guest and
+	  host.
+
+	  To compile this driver as a module, choose M here: the
+	  module will be called vboxsf.
+
+config VBOXVIDEO
+	tristate "VirtualBox Video driver"
+	depends on X86 && VBOXGUEST
+	default m
+	help
+	  This is the video driver for VirtualBox VM.
+
+	  To compile this driver as a module, choose M here: the
+	  module will be called vboxvideo.
+
 source "drivers/misc/c2port/Kconfig"
 source "drivers/misc/eeprom/Kconfig"
 source "drivers/misc/cb710/Kconfig"
diff --git a/drivers/misc/Makefile b/drivers/misc/Makefile
index 537d7f3..c3d31bb 100644
--- a/drivers/misc/Makefile
+++ b/drivers/misc/Makefile
@@ -56,3 +56,6 @@ obj-$(CONFIG_GENWQE)		+= genwqe/
 obj-$(CONFIG_ECHO)		+= echo/
 obj-$(CONFIG_VEXPRESS_SYSCFG)	+= vexpress-syscfg.o
 obj-$(CONFIG_CXL_BASE)		+= cxl/
+obj-$(CONFIG_VBOXGUEST)		+= vboxguest/
+obj-$(CONFIG_VBOXSF)		+= vboxsf/
+obj-$(CONFIG_VBOXVIDEO)		+= vboxvideo/
diff --git a/drivers/misc/vboxguest/Makefile b/drivers/misc/vboxguest/Makefile
index b403647..5235d0d 100644
--- a/drivers/misc/vboxguest/Makefile
+++ b/drivers/misc/vboxguest/Makefile
@@ -18,6 +18,7 @@
 # Linux kbuild sets this to our source directory if we are called from there
 obj ?= $(CURDIR)
 include $(obj)/Makefile.include.header
+KBUILD_EXTMOD=$(obj)
 
 MOD_NAME = vboxguest
 
diff --git a/drivers/misc/vboxsf/Makefile b/drivers/misc/vboxsf/Makefile
index 97f2080..e30e8b9 100644
--- a/drivers/misc/vboxsf/Makefile
+++ b/drivers/misc/vboxsf/Makefile
@@ -17,6 +17,7 @@
 # Linux kbuild sets this to our source directory if we are called from there
 obj ?= $(CURDIR)
 include $(obj)/Makefile.include.header
+KBUILD_EXTMOD=$(obj)
 
 MOD_NAME = vboxsf
 MOD_OBJS   = \
diff --git a/drivers/misc/vboxvideo/Makefile b/drivers/misc/vboxvideo/Makefile
index 3612b5c..03b199d 100644
--- a/drivers/misc/vboxvideo/Makefile
+++ b/drivers/misc/vboxvideo/Makefile
@@ -20,6 +20,7 @@
 # Linux kbuild sets this to our source directory if we are called from there
 obj ?= $(CURDIR)
 include $(obj)/Makefile.include.header
+KBUILD_EXTMOD=$(obj)
 
 MOD_NAME   = vboxvideo
 
-- 
2.9.2

